import{d as M,r as m,o as q,w,c as f,a as e,b as N,v as A,e as x,f as k,u as D,I as F,n as _,t as p,F as P,g as R,h as C,i as V,j as y,k as Q}from"./index-DHSiDqa0.js";import{l as T,Q as K,_ as L}from"./LlmService-jDbyAHJd.js";const O=`The attached file is an exam paper. Read it carefully and extract the data from it.

All information must be accurately drawn from the document exactly. No guesses, estimates or large assumptions should be made (unless explicitly stated otherwise). Extract text in a format that can be displayed on an HTML page (e.g. include line breaks).`,E={prompt:O},B="exam",U="Exam data extracted from a PDF file",j=!0,J={type:"object",properties:{title:{type:"string",description:'Title of the exam paper. ("No title" if not stated).'},description:{type:"string",description:'Description of the exam paper. ("No description" if not stated).'},maxDuration:{type:"number",description:"Maximum allowed duration of the exam in minutes (0 if not stated)."},maxMarks:{type:"number",description:"Maximum number of marks that can be awarded. (0 if not stated)."},questions:{type:"array",description:"Array of all questions that the exam paper asks.",items:{$ref:"#/definitions/ExamQuestion"}}},additionalProperties:!1,required:["title","description","maxDuration","maxMarks","questions"],definitions:{ExamQuestion:{type:"object",properties:{kind:{type:"string",enum:["text","radio","checkbox"],description:"Best format to present the question on an HTML page."},text:{type:"string",description:"The question being asked. Keep the formatting tidy and readable, don't include information already recorded in other fields (e.g. marks, options)."},maxMarks:{type:"number",description:"Maximum number of marks that can be awarded for this question (0 if not stated)."},answerRows:{type:["number","null"],description:"Number of rows for the answer text box (applicable only for text questions)."},options:{type:["array","null"],items:{type:"string"},description:"Array of potential responses (applicable only for radio and checkbox questions)."}},required:["kind","text","maxMarks","answerRows","options"],additionalProperties:!1}}},g={name:B,description:U,strict:j,schema:J};class ${async extractExamQuestions(i){if(!E)return console.error("Prompt for extracting exam data is not available."),null;if(!g||!g)return console.error("Response schema for extracting exam data is not available."),null;const s=await T.sendUserMessage(E.prompt,g,i);let a;try{a=JSON.parse(s),a.fileName=i,a.marked=!1;for(const n of a.questions)n.answer=n.kind===K.Checkbox?[]:""}catch(n){return console.error("Error parsing LLM response:",n,s),null}return a}}const H=new $,z=u=>new Promise((i,s)=>{const a=new FileReader;a.readAsDataURL(u),a.onload=()=>{a.result?i(a.result.toString()):s(new Error("Failed to read file"))},a.onerror=n=>{s(n)}}),Y={class:"space-y-16 mx-auto p-4 sm:px-8 sm:py-16 max-w-7xl container"},G={class:"card"},W={class:"card-body"},X={class:"gap-6 grid grid-cols-1 sm:grid-cols-2"},Z={class:"flex flex-col gap-2"},ee={class:"flex flex-col gap-2"},te={class:"flex flex-col gap-2 sm:col-span-2"},ae={for:"exam-upload",class:"flex flex-col justify-center items-center gap-3 bg-base-100 hover:bg-base-200 px-3 sm:px-6 py-5 sm:py-10 border-2 border-gray-300 border-dashed rounded-md text-center transition cursor-pointer"},oe={class:"flex justify-center sm:col-span-2"},se=["disabled"],re={class:"card-group sm:flex *:not-last:border-e *:not-last:border-base-content/25 max-w-full overflow-x-auto"},ne={class:"card-body"},le={class:"mb-2 h-24 overflow-y-auto text-lg card-title"},ie={class:"mb-4 h-40 overflow-y-auto text-gray-600 dark:text-gray-400 text-sm"},de={class:"card-actions"},pe=M({__name:"home",setup(u){const i=C(),s=m(""),a=m("gpt-4o"),n=m(0),c=m(null),d=m(!1);q(()=>{localStorage.getItem("llm_api_key")&&(s.value=localStorage.getItem("llm_api_key")),localStorage.getItem("llm_model")?a.value=localStorage.getItem("llm_model"):b()});const I=()=>{localStorage.setItem("llm_api_key",s.value)},b=()=>{localStorage.setItem("llm_model",a.value)},v=()=>{let l;try{l=JSON.parse(localStorage.getItem("exams"))||[]}catch{l=[]}return l},S=async()=>{if(!c.value){console.error("No exam uploaded");return}d.value=!0,n.value=0;const l=setInterval(()=>{n.value+=1},1e3);try{const r=await z(c.value);localStorage.setItem(c.value.name,r)}catch(r){console.error("Error storing file:",r),d.value=!1,clearInterval(l);return}const t=v();try{const r=await H.extractExamQuestions(c.value.name);if(!r)throw new Error("Failed to extract questions from uploaded exam");t.push(r),localStorage.setItem("exams",JSON.stringify(t)),await i.push({name:"questions",params:{title:r.title}});return}catch(r){console.error("Error storing exam:",r)}finally{d.value=!1,clearInterval(l)}};return w(s,()=>I()),w(a,()=>b()),(l,t)=>{const r=V("router-link");return y(),f("div",Y,[e("div",G,[e("div",W,[e("div",X,[e("div",Z,[t[3]||(t[3]=e("label",{class:"font-medium",for:"api-key"},"Enter Your OpenAI API Key",-1)),N(e("input",{id:"api-key","onUpdate:modelValue":t[0]||(t[0]=o=>s.value=o),type:"password",class:"bg-base-100 shadow-sm px-4 py-5 border border-gray-300 focus:border-primary rounded-md focus:outline-none focus:ring-2 focus:ring-primary w-full text-base-content transition input placeholder-gray-400",placeholder:"sk-...","aria-label":"OpenAI API Key"},null,512),[[A,s.value]])]),e("div",ee,[t[5]||(t[5]=e("label",{class:"font-medium",for:"model"},"Select AI Model",-1)),x(L,{modelValue:a.value,"onUpdate:modelValue":t[1]||(t[1]=o=>a.value=o),options:["gpt-4o","gpt-4o-mini","o1"]},{default:k(()=>t[4]||(t[4]=[e("small",null,[e("a",{href:"https://platform.openai.com/docs/models",target:"_blank",class:"underline",rel:"noopener"}," Read more about OpenAI models here ")],-1)])),_:1},8,["modelValue"])]),e("div",te,[t[9]||(t[9]=e("label",{class:"font-medium",for:"exam-upload"},"Exam Paper",-1)),e("label",ae,[x(D(F),{icon:"mdi:file-pdf-box",class:"w-20 h-20 text-red-500"}),t[6]||(t[6]=e("p",{class:"font-semibold text-lg"},"Drag and drop a file here",-1)),t[7]||(t[7]=e("p",{class:"text-gray-500 text-md dark:text-gray-400"},"PDF only, max 10MB",-1)),t[8]||(t[8]=e("div",{class:"mt-2"},[e("span",{class:"px-8 sm:px-16 py-4 sm:py-8 btn btn-lg btn-soft btn-primary"},"Select a file")],-1))]),e("input",{id:"exam-upload",type:"file",class:"hidden",accept:".pdf",onChange:t[2]||(t[2]=o=>{var h;return c.value=((h=o.target.files)==null?void 0:h[0])||null}),"aria-label":"Upload Exam File"},null,32)]),e("div",oe,[e("button",{class:_(["px-16 py-6 btn btn-secondary",d.value?"opacity-50 cursor-not-allowed":""]),disabled:d.value,onClick:S},p(d.value?`Extracting... (${n.value}s)`:"Extract Exam Questions"),11,se)])])])]),e("div",re,[(y(!0),f(P,null,R(v(),o=>(y(),f("div",{key:o.title,class:"min-w-80 max-w-xs card"},[e("div",ne,[e("h2",le,p(o.title),1),e("p",ie,p(o.description),1),e("div",de,[x(r,{to:{name:o.marked?"marking":"questions",params:{title:o.title}},class:_(["w-full btn btn-soft",o.marked?"btn-success":"btn-info"])},{default:k(()=>[Q(p(o.marked?"View Results":"Continue"),1)]),_:2},1032,["to","class"])])])]))),128))])])}}});export{pe as default};
