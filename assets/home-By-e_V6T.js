import{d as I,r as m,o as M,w as v,c as f,a as t,b as N,v as R,e as w,f as _,n as k,t as u,F as A,g as C,u as D,h as F,i as x,j as P}from"./index-Cgi_R7eW.js";import{l as V,Q as T,_ as L}from"./LlmService-CIQcAOuU.js";const Q=`The attached file is an exam paper. Read it carefully and extract the data from it.

All information must be accurately drawn from the document exactly. No guesses, estimates or large assumptions should be made (unless explicitly stated otherwise). Extract text in a format that can be displayed on an HTML page (e.g. include line breaks).`,E={prompt:Q},K="exam",O="Exam data extracted from a PDF file",B=!0,U={type:"object",properties:{title:{type:"string",description:'Title of the exam paper. ("No title" if not stated).'},description:{type:"string",description:'Description of the exam paper. ("No description" if not stated).'},maxDuration:{type:"number",description:"Maximum allowed duration of the exam in minutes (0 if not stated)."},maxMarks:{type:"number",description:"Maximum number of marks that can be awarded. (0 if not stated)."},questions:{type:"array",description:"Array of all questions that the exam paper asks.",items:{$ref:"#/definitions/ExamQuestion"}}},additionalProperties:!1,required:["title","description","maxDuration","maxMarks","questions"],definitions:{ExamQuestion:{type:"object",properties:{kind:{type:"string",enum:["text","radio","checkbox"],description:"Best format to present the question on an HTML page."},text:{type:"string",description:"The question being asked. Keep the formatting tidy and readable, don't include information already recorded in other fields (e.g. marks, options)."},maxMarks:{type:"number",description:"Maximum number of marks that can be awarded for this question (0 if not stated)."},answerRows:{type:["number","null"],description:"Number of rows for the answer text box (applicable only for text questions)."},options:{type:["array","null"],items:{type:"string"},description:"Array of potential responses (applicable only for radio and checkbox questions)."}},required:["kind","text","maxMarks","answerRows","options"],additionalProperties:!1}}},g={name:K,description:O,strict:B,schema:U};class J{async extractExamQuestions(i){if(!E)return console.error("Prompt for extracting exam data is not available."),null;if(!g||!g)return console.error("Response schema for extracting exam data is not available."),null;const s=await V.sendUserMessage(E.prompt,g,i);let a;try{a=JSON.parse(s),a.fileName=i,a.marked=!1;for(const n of a.questions)n.answer=n.kind===T.Checkbox?[]:""}catch(n){return console.error("Error parsing LLM response:",n,s),null}return a}}const $=new J,j=p=>new Promise((i,s)=>{const a=new FileReader;a.readAsDataURL(p),a.onload=()=>{a.result?i(a.result.toString()):s(new Error("Failed to read file"))},a.onerror=n=>{s(n)}}),H={class:"space-y-16 mx-auto p-16 container"},z={class:"gap-4 grid grid-cols-2"},G={class:"flex flex-col gap-2"},W={class:"flex flex-col gap-2"},X={class:"flex flex-col gap-2 col-span-2"},Y={class:"flex flex-col gap-4 col-span-2 mt-4"},Z=["disabled"],ee={class:"card-group sm:flex *:not-last:border-e *:not-last:border-base-content/25 sm:max-w-full max-w-sm sm:max-h-128 overflow-x-auto"},te={class:"card-body"},ae={class:"mb-2 h-32 overflow-y-auto card-title"},oe={class:"mb-4 h-64 overflow-y-auto"},se={class:"card-actions"},le=I({__name:"home",setup(p){const i=D(),s=m(""),a=m("gpt-4o"),n=m(0),c=m(null),d=m(!1);M(()=>{localStorage.getItem("llm_api_key")&&(s.value=localStorage.getItem("llm_api_key")),localStorage.getItem("llm_model")?a.value=localStorage.getItem("llm_model"):y()});const q=()=>{localStorage.setItem("llm_api_key",s.value)},y=()=>{localStorage.setItem("llm_model",a.value)},b=()=>{let l;try{l=JSON.parse(localStorage.getItem("exams"))||[]}catch{l=[]}return l},S=async()=>{if(!c.value){console.error("No exam uploaded");return}d.value=!0,n.value=0;const l=setInterval(()=>{n.value+=1},1e3);try{const r=await j(c.value);localStorage.setItem(c.value.name,r)}catch(r){console.error("Error storing file:",r),d.value=!1,clearInterval(l);return}const e=b();try{const r=await $.extractExamQuestions(c.value.name);if(!r)throw new Error("Failed to extract questions from uploaded exam");e.push(r),localStorage.setItem("exams",JSON.stringify(e)),await i.push({name:"questions",params:{title:r.title}});return}catch(r){console.error("Error storing exam:",r)}finally{d.value=!1,clearInterval(l)}};return v(s,()=>q()),v(a,()=>y()),(l,e)=>{const r=F("router-link");return x(),f("div",H,[t("div",z,[t("div",G,[e[3]||(e[3]=t("p",null,"OpenAI API Key",-1)),N(t("input",{"onUpdate:modelValue":e[0]||(e[0]=o=>s.value=o),type:"password",class:"input",placeholder:"sk-something","aria-label":"input"},null,512),[[R,s.value]])]),t("div",W,[e[5]||(e[5]=t("p",null,"Model",-1)),w(L,{modelValue:a.value,"onUpdate:modelValue":e[1]||(e[1]=o=>a.value=o),options:["gpt-4o","gpt-4o-mini","o1"]},{default:_(()=>e[4]||(e[4]=[t("small",null,[t("a",{href:"https://platform.openai.com/docs/models",target:"_blank",class:"underline"},"Read more about OpenAI models here")],-1)])),_:1},8,["modelValue"])]),t("div",X,[e[6]||(e[6]=t("p",null,"Exam Paper",-1)),t("input",{type:"file",class:"input",accept:".pdf",onChange:e[2]||(e[2]=o=>{var h;return c.value=((h=o.target.files)==null?void 0:h[0])||null}),"aria-label":"file-input"},null,32)]),t("div",Y,[t("button",{class:k(["btn btn-soft btn-secondary",d.value?"opacity-50 cursor-not-allowed":""]),disabled:d.value,onClick:S},u(d.value?`Extracting exam questions... (${n.value}s elapsed)`:"Extract exam questions"),11,Z)])]),t("div",ee,[(x(!0),f(A,null,C(b(),o=>(x(),f("div",{key:o.title,class:"min-w-80 max-w-100 card"},[t("div",te,[t("h2",ae,u(o.title),1),t("p",oe,u(o.description),1),t("div",se,[w(r,{to:{name:o.marked?"marking":"questions",params:{title:o.title}},class:k(["w-full btn btn-soft",{"btn-success":o.marked,"btn-info":!o.marked}])},{default:_(()=>[P(u(o.marked?"View results":"Continue"),1)]),_:2},1032,["to","class"])])])]))),128))])])}}});export{le as default};
